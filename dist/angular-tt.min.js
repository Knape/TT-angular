/**
 * Angular TT - Angular wrapper for TT.js
 * @version v0.0.1 - 2014-08-18
 * @link https://github.com/Knape/TT-angular
 * @author Philip Knape <philip.knape@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-tt",[]),angular.module("angular-tt",[]).directive("ttCheck",function(a){return{require:"ngModel",link:function(b,c,d,e){return a(function(){var a;return a=d.value,b.$watch(d.ngModel,function(){$(c).check("update")}),$(c).check({checkboxClass:"icheckbox",radioClass:"iradio_flat-aero"}).on("ifChanged",function(f){return"checkbox"===$(c).attr("type")&&d.ngModel&&b.$apply(function(){return e.$setViewValue(f.target.checked)}),"radio"===$(c).attr("type")&&d.ngModel?b.$apply(function(){return e.$setViewValue(a)}):void 0})})}}}),angular.module("angular-tt",[]).value("ttSelectConfig",{}).directive("ttSelect",function(a,b){var c={};return b&&angular.extend(c,b),{require:"ngModel",priority:1,compile:function(b,d){var e,f,g,h=b.is("select"),i=angular.isDefined(d.multiple);return b.is("select")&&(f=b.find("optgroup[ng-repeat], optgroup[data-ng-repeat], option[ng-repeat], option[data-ng-repeat]"),f.length&&(g=f.attr("ng-repeat")||f.attr("data-ng-repeat"),e=jQuery.trim(g.split("|")[0]).split(" ").pop())),function(b,f,g,j){var k=angular.extend({},c,b.$eval(g.ttSelect)),l=function(a){var b;return k.simple_tags?(b=[],angular.forEach(a,function(a){b.push(a.id)})):b=a,b},m=function(a){var b=[];return a?(k.simple_tags?(b=[],angular.forEach(a,function(a){b.push({id:a,text:a})})):b=a,b):b};if(h?(delete k.multiple,delete k.initSelection):i&&(k.multiple=!0),j&&(b.$watch(d.ngModel,function(a,b){a&&a!==b&&j.$render()},!0),j.$render=function(){if(h)f.select2("val",j.$viewValue);else if(k.multiple){j.$isEmpty=function(a){return!a||0===a.length};var a=j.$viewValue;angular.isString(a)&&(a=a.split(",")),f.select("data",m(a)),k.sortable&&f.select("container").find("ul.select2-choices").sortable({containment:"parent",start:function(){f.select("onSortStart")},update:function(){f.select("onSortEnd"),f.trigger("change")}})}else angular.isObject(j.$viewValue)?f.select("data",j.$viewValue):j.$viewValue?f.select("val",j.$viewValue):f.select("data",null)},e&&b.$watch(e,function(b,c){angular.equals(b,c)||a(function(){f.select2("val",j.$viewValue),j.$render(),b&&!c&&j.$setPristine&&j.$setPristine(!0)})}),j.$parsers.push(function(a){var b=f.prev();return b.toggleClass("ng-invalid",!j.$valid).toggleClass("ng-valid",j.$valid).toggleClass("ng-invalid-required",!j.$valid).toggleClass("ng-valid-required",j.$valid).toggleClass("ng-dirty",j.$dirty).toggleClass("ng-pristine",j.$pristine),a}),!h&&(f.bind("change",function(a){a.stopImmediatePropagation(),b.$$phase||b.$root.$$phase||b.$apply(function(){j.$setViewValue(l(f.select("data")))})}),k.initSelection))){var n=k.initSelection;k.initSelection=function(a,b){n(a,function(a){var c=j.$pristine;j.$setViewValue(l(a)),b(a),c&&j.$setPristine(),f.prev().toggleClass("ng-pristine",j.$pristine)})}}f.bind("$destroy",function(){f.select("destroy")}),g.$observe("disabled",function(a){f.select("enable",!a)}),g.$observe("readonly",function(a){f.select("readonly",!!a)}),g.ngMultiple&&b.$watch(g.ngMultiple,function(a){g.$set("multiple",!!a),f.select2(k)}),a(function(){if(f.select(k),f.select("data",j.$modelValue),j.$render(),!k.initSelection&&!h){var a=j.$pristine;j.$pristine=!1,j.$setViewValue(l(f.select2("data"))),a&&j.$setPristine(),f.prev().toggleClass("ng-pristine",j.$pristine)}})}}}}),angular.module("angular-tt",[]).directive("ttSwitch",function(){return{restrict:"EA",replace:!0,require:"ngModel",scope:{disabled:"@",onLabel:"@",offLabel:"@",knobLabel:"@"},template:'<div role="radio" class="switch has-switch" ng-class="{ \'disabled\': disabled, \'switch-off\': !model, \'switch-on\': model }"><div class="switch-animate" ng-class="{\'switch-off\': !model, \'switch-on\': model}"><span class="switch-left" ng-bind="onLabel"></span><label ng-bind="knobLabel"></label><span class="switch-right" ng-bind="offLabel"></span></div></div>',link:function(a,b,c,d){c.onLabel||(c.onLabel="On"),c.offLabel||(c.offLabel="Off"),c.knobLabel||(c.knobLabel="Â "),c.disabled||(c.disabled=!1),b.on("click",function(){a.$apply(a.toggle)}),d.$formatters.push(function(a){return a}),d.$parsers.push(function(a){return a}),d.$render=function(){a.model=d.$viewValue},a.toggle=function(){a.disabled||(a.model=!a.model,d.$setViewValue(a.model))}}}}),angular.module("angular-tt",[]).directive("ttWysiwyg",function(){return{restrict:"A",require:"ngModel",transclude:!0,link:function(a,b,c,d){var e=b.wysiwyg({html:!0}),f=e.data("wysiwyg").editor;f.on("change",function(){f.getValue()&&a.$apply(function(){d.$setViewValue(f.getValue())})}),d.$render=function(){e.html(d.$viewValue),f.setValue(d.$viewValue)},d.$render()}}}),angular.module("angular-tt",[]).factory("TT",function(){var a;return a=window.TT}).factory("ttService",function(a,b){var c={};return c.init=function(){var c=a.defer();return b.native.init().done(function(a){c.resolve(a)}).fail(function(){console.log("ERROR")}),c.promise},c.getMe=function(){var c=a.defer();return b.api.get("v1/me").done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise},c.getProducts=function(c){var d=a.defer();return b.api.get("v1/stores/"+c+"/products").done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise},c.loaded=function(){return b.native.loaded()},c.loading=function(){return b.native.loading()},c.performCard=function(){return b.native.performCard()},c.reportSize=function(a){return b.native.reportSize(a)},c.showShareDialog=function(a,c){return b.showShareDialog(a,c)},c.showStatus=function(a){return b.native.showStatus(a)},c.accessToken=function(){return b.native.accessToken},c});